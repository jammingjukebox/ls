<html>
    <head>
        <style>
            img {
                position: absolute;
            }
            html, body {margin: 0; height: 100%; overflow: hidden}
            #jukebox {
                position: fixed;
                bottom: 10%;
                right: 10%;
                height: 5%;
                z-index: 99;
            }

        </style>
    </head>
    <body>
        <audio src="./media/audio/tune.wav" autostart="false" hidden="true" loop="true" id="tune" style="display:none;"></audio>
        <span id = "jukebox">
            <img id="staticImage" src="./media/gifs/jammingjukebox_static.gif"  style="cursor: pointer;" onclick="toggleAnimation(); return false;">
            <img id="animatedImage" src="./media/gifs/jammingjukebox.gif" style="display: none; cursor: pointer;" onclick="toggleAnimation(); return false;">
        </span>
        <script>

            async function countImages() {
                let count = 0;
                let found = true;
                while (found) {
                    try {
                        const response = await fetch(`./media/pics/${count}.jpg`);
                        if (response.ok) {
                            count++;
                        } else {
                            found = false;
                        }
                    } catch (e) {
                        found = false;
                    }
                }
                return count;
            }

            
            function shuffle(array) {
                let currentIndex = array.length;

                while (currentIndex != 0) {

                    let randomIndex = Math.floor(Math.random() * currentIndex);
                    currentIndex--;

                    [array[currentIndex], array[randomIndex]] = [
                    array[randomIndex], array[currentIndex]];
                }
                }

            function start() {
                countImages().then((count) => {
                    console.log(`number of images: ${count}`);
                    place_images( count );
                });
            }



            start()



            function place_images(numImages) {
                const height = window.innerHeight;
                const width = window.innerWidth;
                let array = Array(numImages).fill().map((_, index) => index);
                shuffle(array)
                console.log(array)

                let maxHeight = Math.floor(height * 0.7 * 0.8);
                let minHeight = Math.floor((height / 4) * 0.8);
                
                for ( let i = 0; i < numImages; i++ ) {
                    let img_src = `./media/pics/${array[i]}.jpg`;
                    
                    let img_height = Math.floor(Math.random() * (maxHeight - minHeight) + minHeight);
                    let img_x = Math.floor(Math.random() * width - img_height / 2);
                    let img_y = Math.floor(Math.random() * height - img_height / 2);

                    document.body.innerHTML += `<img src="${img_src}" height="${img_height}" style="top:${img_y}; left:${img_x};">`;
                    console.log("loaded " + (i+1) + " images");
                }
                console.log("finished loading images");

            }


            function toggleAnimation() {
            var staticImage = document.getElementById("staticImage");
            var animatedImage = document.getElementById("animatedImage");
            var audio = document.getElementById("tune");

            if (staticImage.style.display === "none") {
            audio.pause();
            staticImage.style.display = "block";
            animatedImage.style.display = "none";
            } else {
            audio.play();
            staticImage.style.display = "none";
            animatedImage.style.display = "block";
            }
        }
        </script>
    </body>
</html>